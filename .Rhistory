# Usamos AGLOMERADO directamente. ggplot usará sus etiquetas
aes(x = fecha_decimal,
y = tasa_desempleo_pct,
color = AGLOMERADO,
group = AGLOMERADO)) +
geom_line(linewidth = 1.1) +
geom_point(size = 1.5) +
# --- Ajustar los ejes ---
scale_x_continuous(
breaks = seq(floor(min(plot_data$fecha_decimal)),
ceiling(max(plot_data$fecha_decimal)), by = 1)
) +
scale_y_continuous(
labels = function(y) paste0(round(y, 0), "%")
) +
# --- Títulos y etiquetas ---
labs(
title = "Tasa de Desempleo (Serie de Tiempo)",
subtitle = "Evolución trimestral en 5 grandes aglomerados (2017-2025)",
y = "Tasa de Desempleo",
x = "Año",
color = "Aglomerado" # Título de la leyenda
) +
# --- Tema y leyenda ---
theme_minimal() +
theme(
legend.position = "bottom",
plot.title = element_text(face = "bold", size = 16),
plot.subtitle = element_text(size = 12),
axis.title = element_text(size = 11, face = "bold")
)
# --- Guardar el gráfico ---
ggsave("grafico_1a_desempleo_series.png", plot = g, width = 11, height = 7, dpi = 300)
# --- Mostrar el gráfico (en RStudio) ---
print(g)
# --- 0. Carga de Librerías ---
library(dplyr)
library(readr)
library(ggplot2)
library(ggrepel) # Para las etiquetas (si no la tenés: install.packages("ggrepel"))
install.packages("ggrepel")
# --- 0. Carga de Librerías ---
library(dplyr)
library(readr)
library(ggplot2)
library(ggrepel)
## -----------------------------------------------
## 1. CÁLCULO DE TASAS DE MERCADO LABORAL
## -----------------------------------------------
# --- Cargar la base de datos procesada ---
# (Asegurate de que la ruta sea la correcta)
# eph_base_labeled <- read_rds("eph_data/eph_individual_2017_2025_std.rds")
# --- Calcular las tasas ---
tasas_mercado_laboral <- eph_base_labeled %>%
# Asegurar que ESTADO sea numérico para el filtro
mutate(ESTADO = as.numeric(ESTADO)) %>%
# Agrupar por tiempo y aglomerado
group_by(ANO4, TRIMESTRE, AGLOMERADO) %>%
# Calcular los agregados poblacionales
summarise(
# Ocupados (ESTADO == 1)
total_ocupados = sum(PONDERA[ESTADO == 1], na.rm = TRUE),
# Desocupados (ESTADO == 2)
total_desocupados = sum(PONDERA[ESTADO == 2], na.rm = TRUE),
# Población Económicamente Activa (PEA)
pea = total_ocupados + total_desocupados,
# Población de referencia (10 años o más) = PEA + Inactivos (ESTADO == 3)
pob_10_mas = pea + sum(PONDERA[ESTADO == 3], na.rm = TRUE),
.groups = 'drop'
) %>%
# Calcular las tasas (con control de división por cero)
mutate(
# Tasa de Actividad (Participación)
tasa_actividad = ifelse(pob_10_mas == 0, NA, pea / pob_10_mas),
# Tasa de Empleo
tasa_empleo = ifelse(pob_10_mas == 0, NA, total_ocupados / pob_10_mas),
# Tasa de Desempleo
tasa_desempleo = ifelse(pea == 0, NA, total_desocupados / pea)
) %>%
# Ordenar para ver lo más reciente primero
arrange(desc(ANO4), desc(TRIMESTRE), AGLOMERADO)
# --- Ver los resultados en la consola ---
print(tasas_mercado_laboral, n = 40)
## -----------------------------------------------
## 2. GRÁFICO DE SERIES DE TIEMPO CON ETIQUETAS
## -----------------------------------------------
# --- Definir los códigos de aglomerados a graficar ---
# 32=CABA, 33=GBA, 13=Cordoba, 4=Rosario, 10=Mendoza
aglomerados_grandes_cods <- c(32, 33, 13, 4, 10)
# --- Preparar los datos para el gráfico ---
plot_data <- tasas_mercado_laboral %>%
# Convertir AGLOMERADO a numérico para poder filtrar por código
mutate(AGLOMERADO_NUM = as.numeric(AGLOMERADO)) %>%
# Filtrar solo los aglomerados que queremos
filter(AGLOMERADO_NUM %in% aglomerados_grandes_cods) %>%
# Crear la variable de tiempo contínua y la tasa en %
mutate(
# Fecha decimal: 2017 Trim 1 -> 2017.0, Trim 2 -> 2017.25
fecha_decimal = ANO4 + (TRIMESTRE - 1) / 4,
# Convertir la tasa a porcentaje para el eje Y
tasa_desempleo_pct = tasa_desempleo * 100
)
# --- Crear un data.frame solo para las etiquetas ---
# (Nos quedamos con el último punto de cada aglomerado)
label_data <- plot_data %>%
group_by(AGLOMERADO) %>%
slice_max(order_by = fecha_decimal, n = 1) %>%
ungroup()
# --- Crear el gráfico ---
g <- ggplot(plot_data,
# Usamos AGLOMERADO directamente (ggplot usará sus etiquetas)
aes(x = fecha_decimal,
y = tasa_desempleo_pct,
color = AGLOMERADO,
group = AGLOMERADO)) +
geom_line(linewidth = 1.1) +
geom_point(size = 1.5) +
# --- Añadir labels al final de cada línea ---
geom_label_repel(
data = label_data, # Usamos el data.frame filtrado
aes(label = AGLOMERADO), # La etiqueta será el nombre del aglomerado
nudge_x = 0.25,          # Empuja la etiqueta a la derecha del punto
direction = "y",         # Prioritiza mover la etiqueta verticalmente
hjust = 0,               # Alinea el texto a la izquierda
segment.color = 'grey50',# Color de la línea que une etiqueta y punto
size = 3.5               # Tamaño del texto
) +
# --- Ajustar los ejes ---
scale_x_continuous(
# Damos un poco más de espacio a la derecha para las etiquetas
limits = c(min(plot_data$fecha_decimal), max(plot_data$fecha_decimal) + 0.5),
breaks = seq(floor(min(plot_data$fecha_decimal)),
ceiling(max(plot_data$fecha_decimal)), by = 1)
) +
scale_y_continuous(
labels = function(y) paste0(round(y, 0), "%")
) +
# --- Títulos y etiquetas ---
labs(
title = "Tasa de Desempleo (Serie de Tiempo)",
subtitle = "Evolución trimestral en 5 grandes aglomerados (2017-2025)",
y = "Tasa de Desempleo",
x = "Año"
) +
# --- Tema y leyenda ---
theme_minimal() +
theme(
legend.position = "none", # Sacamos la leyenda, ya tenemos labels
plot.title = element_text(face = "bold", size = 16),
plot.subtitle = element_text(size = 12),
axis.title = element_text(size = 11, face = "bold")
)
# --- Guardar el gráfico ---
ggsave("grafico_1a_desempleo_series_con_labels.png", plot = g, width = 11, height = 7, dpi = 300)
# --- Mostrar el gráfico (en RStudio) ---
print(g)
# --- 0. Carga de Librerías ---
library(dplyr)
library(readr)
library(ggplot2)
library(ggrepel) # Para las etiquetas (si no la tenés: install.packages("ggrepel"))
## -----------------------------------------------
## 1. CÁLCULO DE TASAS DE MERCADO LABORAL
## -----------------------------------------------
# --- Cargar la base de datos procesada ---
# (Asegurate de que la ruta sea la correcta)
# eph_base_labeled <- read_rds("eph_data/eph_individual_2017_2025_std.rds")
# --- Calcular las tasas ---
tasas_mercado_laboral <- eph_base_labeled %>%
# Asegurar que ESTADO sea numérico para el filtro
mutate(ESTADO = as.numeric(ESTADO)) %>%
# Agrupar por tiempo y aglomerado
group_by(ANO4, TRIMESTRE, AGLOMERADO) %>%
# Calcular los agregados poblacionales
summarise(
# Ocupados (ESTADO == 1)
total_ocupados = sum(PONDERA[ESTADO == 1], na.rm = TRUE),
# Desocupados (ESTADO == 2)
total_desocupados = sum(PONDERA[ESTADO == 2], na.rm = TRUE),
# Población Económicamente Activa (PEA)
pea = total_ocupados + total_desocupados,
# Población de referencia (10 años o más) = PEA + Inactivos (ESTADO == 3)
pob_10_mas = pea + sum(PONDERA[ESTADO == 3], na.rm = TRUE),
.groups = 'drop'
) %>%
# Calcular las tasas (con control de división por cero)
mutate(
# Tasa de Actividad (Participación)
tasa_actividad = ifelse(pob_10_mas == 0, NA, pea / pob_10_mas),
# Tasa de Empleo
tasa_empleo = ifelse(pob_10_mas == 0, NA, total_ocupados / pob_10_mas),
# Tasa de Desempleo
tasa_desempleo = ifelse(pea == 0, NA, total_desocupados / pea)
) %>%
# Ordenar para ver lo más reciente primero
arrange(desc(ANO4), desc(TRIMESTRE), AGLOMERADO)
# --- Ver los resultados en la consola ---
print(tasas_mercado_laboral, n = 40)
## -----------------------------------------------
## 2. GRÁFICO DE SERIES DE TIEMPO CON ETIQUETAS
## -----------------------------------------------
# --- Definir los códigos de aglomerados a graficar ---
# 32=CABA, 33=GBA, 13=Cordoba, 4=Rosario, 10=Mendoza
aglomerados_grandes_cods <- c(32, 33, 13, 4, 10)
# --- Preparar los datos para el gráfico ---
plot_data <- tasas_mercado_laboral %>%
# Convertir AGLOMERADO a numérico para poder filtrar por código
mutate(AGLOMERADO_NUM = as.numeric(AGLOMERADO)) %>%
# Filtrar solo los aglomerados que queremos
filter(AGLOMERADO_NUM %in% aglomerados_grandes_cods) %>%
# Crear la variable de tiempo contínua y la tasa en %
mutate(
# Fecha decimal: 2017 Trim 1 -> 2017.0, Trim 2 -> 2017.25
fecha_decimal = ANO4 + (TRIMESTRE - 1) / 4,
# Convertir la tasa a porcentaje para el eje Y
tasa_desempleo_pct = tasa_desempleo * 100
)
# --- Crear un data.frame solo para las etiquetas ---
# (Nos quedamos con el último punto de cada aglomerado)
label_data <- plot_data %>%
group_by(AGLOMERADO) %>%
slice_max(order_by = fecha_decimal, n = 1) %>%
ungroup() %>%
# --- ¡AQUÍ ESTÁ EL CAMBIO! ---
# Creamos la columna de etiquetas cortas
mutate(
label_corta = case_when(
as.character(AGLOMERADO) == "Partidos del GBA" ~ "GBA",
as.character(AGLOMERADO) == "Ciudad de Buenos Aires" ~ "CABA",
as.character(AGLOMERADO) == "Gran Cordoba" ~ "Gran Córdoba",
TRUE ~ as.character(AGLOMERADO) # Mantiene el resto como está
)
)
# --- Crear el gráfico ---
g <- ggplot(plot_data,
# Usamos AGLOMERADO directamente (ggplot usará sus etiquetas)
aes(x = fecha_decimal,
y = tasa_desempleo_pct,
color = AGLOMERADO,
group = AGLOMERADO)) +
geom_line(linewidth = 1.1) +
geom_point(size = 1.5) +
# --- Añadir labels al final de cada línea ---
geom_label_repel(
data = label_data, # Usamos el data.frame filtrado
# --- ¡AQUÍ ESTÁ EL OTRO CAMBIO! ---
aes(label = label_corta), # Usamos la etiqueta corta
nudge_x = 0.25,          # Empuja la etiqueta a la derecha del punto
direction = "y",         # Prioritiza mover la etiqueta verticalmente
hjust = 0,               # Alinea el texto a la izquierda
segment.color = 'grey50',# Color de la línea que une etiqueta y punto
size = 3.5               # Tamaño del texto
) +
# --- Ajustar los ejes ---
scale_x_continuous(
# Damos un poco más de espacio a la derecha para las etiquetas
limits = c(min(plot_data$fecha_decimal), max(plot_data$fecha_decimal) + 0.5),
breaks = seq(floor(min(plot_data$fecha_decimal)),
ceiling(max(plot_data$fecha_decimal)), by = 1)
) +
scale_y_continuous(
labels = function(y) paste0(round(y, 0), "%")
) +
# --- Títulos y etiquetas ---
labs(
title = "Tasa de Desempleo (Serie de Tiempo)",
subtitle = "Evolución trimestral en 5 grandes aglomerados (2017-2025)",
y = "Tasa de Desempleo",
x = "Año"
) +
# --- Tema y leyenda ---
theme_minimal() +
theme(
legend.position = "none", # Sacamos la leyenda, ya tenemos labels
plot.title = element_text(face = "bold", size = 16),
plot.subtitle = element_text(size = 12),
axis.title = element_text(size = 11, face = "bold")
)
# --- Guardar el gráfico ---
ggsave("grafico_1a_desempleo_series_con_labels_cortos.png", plot = g, width = 11, height = 7, dpi = 300)
# --- Mostrar el gráfico (en RStudio) ---
print(g)
tasas_mercado_laboral
# --- Calcular las tasas ---
tasas_mercado_laboral <- eph_base_labeled %>%
# Asegurar que ESTADO sea numérico para el filtro
mutate(ESTADO = as.numeric(ESTADO)) %>%
# Agrupar por tiempo y aglomerado
group_by(ANO4, TRIMESTRE, AGLOMERADO) %>%
# Calcular los agregados poblacionales
summarise(
# Ocupados (ESTADO == 1)
total_ocupados = sum(PONDERA[ESTADO == 1], na.rm = TRUE),
# Desocupados (ESTADO == 2)
total_desocupados = sum(PONDERA[ESTADO == 2], na.rm = TRUE),
# Población Económicamente Activa (PEA)
pea = total_ocupados + total_desocupados,
# Población de referencia (10 años o más) = PEA + Inactivos (ESTADO == 3)
pob_10_mas = pea + sum(PONDERA[ESTADO == 3], na.rm = TRUE),
.groups = 'drop'
) %>%
# Calcular las tasas (con control de división por cero)
mutate(
# Tasa de Actividad (Participación)
tasa_actividad = ifelse(pob_10_mas == 0, NA, pea / pob_10_mas),
# Tasa de Empleo
tasa_empleo = ifelse(pob_10_mas == 0, NA, total_ocupados / pob_10_mas),
# Tasa de Desempleo
tasa_desempleo = ifelse(pea == 0, NA, total_desocupados / pea)
) %>%
# Ordenar para ver lo más reciente primero
arrange(desc(ANO4), desc(TRIMESTRE), AGLOMERADO)
# --- Ver los resultados en la consola ---
print(tasas_mercado_laboral, n = 40)
# --- Definir los códigos de aglomerados a graficar ---
# 32=CABA, 33=GBA, 13=Cordoba, 4=Rosario, 10=Mendoza
aglomerados_grandes_cods <- c(32, 33, 13, 4, 10)
# --- Preparar los datos para el gráfico ---
plot_data <- tasas_mercado_laboral %>%
# Convertir AGLOMERADO a numérico para poder filtrar por código
mutate(AGLOMERADO_NUM = as.numeric(AGLOMERADO)) %>%
# Filtrar solo los aglomerados que queremos
filter(AGLOMERADO_NUM %in% aglomerados_grandes_cods) %>%
# Crear la variable de tiempo contínua y la tasa en %
mutate(
# Fecha decimal: 2017 Trim 1 -> 2017.0, Trim 2 -> 2017.25
fecha_decimal = ANO4 + (TRIMESTRE - 1) / 4,
# Convertir la tasa a porcentaje para el eje Y
tasa_desempleo_pct = tasa_desempleo * 100
)
# --- Crear un data.frame solo para las etiquetas ---
# (Nos quedamos con el último punto de cada aglomerado)
label_data <- plot_data %>%
group_by(AGLOMERADO) %>%
slice_max(order_by = fecha_decimal, n = 1) %>%
ungroup() %>%
# --- ¡AQUÍ ESTÁ LA CORRECCIÓN! ---
# 1. Convertir AGLOMERADO a factor (para que use las etiquetas de texto)
# 2. Usar ese factor para crear las etiquetas cortas
mutate(
AGLOMERADO_FACTOR = as.factor(AGLOMERADO),
label_corta = case_when(
AGLOMERADO_FACTOR == "Partidos del GBA" ~ "GBA",
AGLOMERADO_FACTOR == "Ciudad de Buenos Aires" ~ "CABA",
AGLOMERADO_FACTOR == "Gran Cordoba" ~ "Gran Córdoba",
TRUE ~ as.character(AGLOMERADO_FACTOR) # Mantiene el resto como está
)
)
# --- Crear el gráfico ---
g <- ggplot(plot_data,
# Usamos AGLOMERADO directamente (ggplot usará sus etiquetas)
aes(x = fecha_decimal,
y = tasa_desempleo_pct,
color = AGLOMERADO,
group = AGLOMERADO)) +
geom_line(linewidth = 1.1) +
geom_point(size = 1.5) +
# --- Añadir labels al final de cada línea ---
geom_label_repel(
data = label_data, # Usamos el data.frame filtrado
# Usamos la nueva columna de etiquetas cortas
aes(label = label_corta),
nudge_x = 0.25,          # Empuja la etiqueta a la derecha del punto
direction = "y",         # Prioritiza mover la etiqueta verticalmente
hjust = 0,               # Alinea el texto a la izquierda
segment.color = 'grey50',# Color de la línea que une etiqueta y punto
size = 3.5               # Tamaño del texto
) +
# --- Ajustar los ejes ---
scale_x_continuous(
# Damos un poco más de espacio a la derecha para las etiquetas
limits = c(min(plot_data$fecha_decimal), max(plot_data$fecha_decimal) + 0.5),
breaks = seq(floor(min(plot_data$fecha_decimal)),
ceiling(max(plot_data$fecha_decimal)), by = 1)
) +
scale_y_continuous(
labels = function(y) paste0(round(y, 0), "%")
) +
# --- Títulos y etiquetas ---
labs(
title = "Tasa de Desempleo (Serie de Tiempo)",
subtitle = "Evolución trimestral en 5 grandes aglomerados (2017-2025)",
y = "Tasa de Desempleo",
x = "Año"
) +
# --- Tema y leyenda ---
theme_minimal() +
theme(
legend.position = "none", # Sacamos la leyenda, ya tenemos labels
plot.title = element_text(face = "bold", size = 16),
plot.subtitle = element_text(size = 12),
axis.title = element_text(size = 11, face = "bold")
)
# --- Guardar el gráfico ---
ggsave("grafico_1a_desempleo_series_con_labels_cortos.png", plot = g, width = 11, height = 7, dpi = 300)
# --- Mostrar el gráfico (en RStudio) ---
print(g)
# --- Calcular las tasas ---
tasas_mercado_laboral <- eph_base_labeled %>%
# Asegurar que ESTADO sea numérico para el filtro
mutate(ESTADO = as.numeric(ESTADO)) %>%
# Agrupar por tiempo y aglomerado
group_by(ANO4, TRIMESTRE, AGLOMERADO) %>%
# Calcular los agregados poblacionales
summarise(
# Ocupados (ESTADO == 1)
total_ocupados = sum(PONDERA[ESTADO == 1], na.rm = TRUE),
# Desocupados (ESTADO == 2)
total_desocupados = sum(PONDERA[ESTADO == 2], na.rm = TRUE),
# Población Económicamente Activa (PEA)
pea = total_ocupados + total_desocupados,
# Población de referencia (10 años o más) = PEA + Inactivos (ESTADO == 3)
pob_10_mas = pea + sum(PONDERA[ESTADO == 3], na.rm = TRUE),
.groups = 'drop'
) %>%
# Calcular las tasas (con control de división por cero)
mutate(
# Tasa de Actividad (Participación)
tasa_actividad = ifelse(pob_10_mas == 0, NA, pea / pob_10_mas),
# Tasa de Empleo
tasa_empleo = ifelse(pob_10_mas == 0, NA, total_ocupados / pob_10_mas),
# Tasa de Desempleo
tasa_desempleo = ifelse(pea == 0, NA, total_desocupados / pea)
) %>%
# Ordenar para ver lo más reciente primero
arrange(desc(ANO4), desc(TRIMESTRE), AGLOMERADO)
# --- Ver los resultados en la consola ---
print(tasas_mercado_laboral, n = 40)
# --- Definir los códigos de aglomerados a graficar ---
# 32=CABA, 33=GBA, 13=Cordoba, 4=Rosario, 10=Mendoza
aglomerados_grandes_cods <- c(32, 33, 13, 4, 10)
# --- Preparar los datos para el gráfico ---
plot_data <- tasas_mercado_laboral %>%
# Convertir AGLOMERADO a numérico para poder filtrar por código
mutate(AGLOMERADO_NUM = as.numeric(AGLOMERADO)) %>%
# Filtrar solo los aglomerados que queremos
filter(AGLOMERADO_NUM %in% aglomerados_grandes_cods) %>%
# Crear la variable de tiempo contínua y la tasa en %
mutate(
# Fecha decimal: 2017 Trim 1 -> 2017.0, Trim 2 -> 2017.25
fecha_decimal = ANO4 + (TRIMESTRE - 1) / 4,
# Convertir la tasa a porcentaje para el eje Y
tasa_desempleo_pct = tasa_desempleo * 100
)
# --- Crear un data.frame solo para las etiquetas ---
# (Nos quedamos con el último punto de cada aglomerado)
label_data <- plot_data %>%
group_by(AGLOMERADO) %>%
slice_max(order_by = fecha_decimal, n = 1) %>%
ungroup() %>%
# --- ¡AQUÍ ESTÁ LA CORRECCIÓN! ---
# Usamos la columna AGLOMERADO_NUM (que es puramente numérica)
# para la comparación en case_when().
mutate(
label_corta = case_when(
AGLOMERADO_NUM == 33 ~ "GBA",
AGLOMERADO_NUM == 32 ~ "CABA",
AGLOMERADO_NUM == 13 ~ "Gran Córdoba",
AGLOMERADO_NUM == 4  ~ "Gran Rosario",
AGLOMERADO_NUM == 10 ~ "Gran Mendoza",
TRUE ~ as.character(AGLOMERADO) # Default por si acaso
)
)
# --- Crear el gráfico ---
g <- ggplot(plot_data,
# Usamos AGLOMERADO para el color/grupo
aes(x = fecha_decimal,
y = tasa_desempleo_pct,
color = AGLOMERADO,
group = AGLOMERADO)) +
geom_line(linewidth = 1.1) +
geom_point(size = 1.5) +
# --- Añadir labels al final de cada línea ---
geom_label_repel(
data = label_data, # Usamos el data.frame filtrado
# --- Usamos la nueva columna de etiquetas cortas ---
aes(label = label_corta),
nudge_x = 0.25,          # Empuja la etiqueta a la derecha del punto
direction = "y",         # Prioritiza mover la etiqueta verticalmente
hjust = 0,               # Alinea el texto a la izquierda
segment.color = 'grey50',# Color de la línea que une etiqueta y punto
size = 3.5               # Tamaño del texto
) +
# --- Ajustar los ejes ---
scale_x_continuous(
# Damos un poco más de espacio a la derecha para las etiquetas
limits = c(min(plot_data$fecha_decimal), max(plot_data$fecha_decimal) + 0.5),
breaks = seq(floor(min(plot_data$fecha_decimal)),
ceiling(max(plot_data$fecha_decimal)), by = 1)
) +
scale_y_continuous(
labels = function(y) paste0(round(y, 0), "%")
) +
# --- Títulos y etiquetas ---
labs(
title = "Tasa de Desempleo (Serie de Tiempo)",
subtitle = "Evolución trimestral en 5 grandes aglomerados (2017-2025)",
y = "Tasa de Desempleo",
x = "Año"
) +
# --- Tema y leyenda ---
theme_minimal() +
theme(
legend.position = "none", # Sacamos la leyenda, ya tenemos labels
plot.title = element_text(face = "bold", size = 16),
plot.subtitle = element_text(size = 12),
axis.title = element_text(size = 11, face = "bold")
)
# --- Mostrar el gráfico (en RStudio) ---
print(g)
# --- Guardar el gráfico ---
ggsave("grafico_1a.png", plot = g, width = 11, height = 7, dpi = 300)
